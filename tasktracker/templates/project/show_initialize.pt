<span tal:condition="c/error" style="border:1px black dashed; color:#f00;"> 
<span tal:replace="c/error" />
<br/><br/>
</span>

<span tal:replace="c/project/title" /> has never used the task tracker before.  To get started, please decide some basic settings.<br/>

<form tal:attributes="action python:h.url_for(controller='project', action='initialize')" method="post" id="theform">

<p>Once a task list is created, it can have individual security settings
to control who can create, edit, view, assign or be assigned tasks.
The security setting on this page is for creating task lists.</p>

<label for="create_list_permission">Who can create new task lists?</label> <select name="create_list_permission">
<option tal:attributes="value c/adminLevel">Just project administrators</option>
<option tal:attributes="value c/memberLevel">Project members too</option>
</select><br/><br/>

<input type="hidden" value="" id="statuses" name="statuses">

</form>


<h2><strong>Statuses</strong></h2>

<p> During its lifetime, a task could have many statuses.  Perhaps it
starts out as 'new', becomes 'pending' when someone has decided that
it is worth doing, and then finally becomes 'done'.  
</p>

<form action="#" onsubmit = "addStatus($('new_status').value);$('new_status').value=''; return false;" >
<ul id="status_list" class="task_list">
<li id="done">
<input type="checkbox" disabled="disabled"/>
<span>done</span>
</li>
</ul>
<label for="new_status">Add a status:</label> <input name="new_status" type="text" id="new_status">

<input type="submit" name="submit" value="Add a status" />

<p>
<input type="submit" name="submit" value="Set up the task tracker" onclick="$('theform').submit(); return false;"/>
</p>
</form>

<script language="javascript">

function updateStatus() {
    //update the form variable
    var status_list = $('status_list');
    var statuses = status_list.getElementsByTagName('li')
    var s = '';

    for (i = 0; i < statuses.length; ++i) {
        s += getStatusName(statuses[i]);
	s += ',';
    }

    $('statuses').value = s;
}

function deleteStatus(status_name) {
    $(status_name).parentNode.remove();
    updateStatus();
}

function getStatusName(status_li) {
    return status_li.getElementsByTagName('span')[0].childNodes[0].nodeValue;
}

function addStatus(status) {
    status = status.replace(/[^A-Za-z0-9 ]/g, '');

    if (status.length < 1) {
        return;
    }

    status = status.toLowerCase();

    //prevent duplication

    var status_list = $('status_list');
    var statuses = status_list.getElementsByTagName('li');

    for (i = 0; i < statuses.length; ++i) {

        if (getStatusName(statuses[i]) == status) {
            return;
        }
    } 
    //add the html element

    var status_name = 'status_' + statuses.length;
    var del = 'deleteStatus(\'' + status_name + '\');';
    var check = Builder.node('input', {'id' : status_name, 'type' : 'checkbox', 'onclick' : del});
    var li = Builder.node('li', [check, Builder.node('span', status)]);

    done = $('done');
    status_list.insertBefore(li, done);

    updateStatus();
}

addStatus('not done');
</script>
