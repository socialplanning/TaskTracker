<metal:macro metal:define-macro="view_task">

<li tal:attributes="id string:task_${atask/id}; task_id atask/id; style string:line-height: 2em;;; sort_index atask/sort_index; owner atask/owner; deadline atask/deadline; status atask/status">

<span tal:attributes="style python:'padding-left: %dpx;;' % ((atask.depth() - c.depth) * 15); depth python: atask.depth() - c.depth" class="taskitem">

<img tal:attributes="src python:test(atask.liveChildren(), '/images/plus.png', '/images/blank.png'); id string:collapseButton_${atask/id}; onclick string:toggleCollapse(${atask/id});" />

<!-- drag handle -->
<span>
<img tal:attributes="id string:handle_${atask/id}" src="/images/folder_open.png" class="handle">
</span>

<!-- title -->
<a tal:attributes="href python:h.url_for(controller='task', action='view', id=atask.id)">
<span tal:content="atask/title" tal:attributes="style python: '%s%s' % (test(atask.status=='done', 'text-decoration:line-through;;', ''), test(atask.parentID != 0, 'font-size:0.95em', 'font-size:1.1em')); id string:title_${atask/id}"/></a><span tal:condition="atask/private" tal:attributes="style string: color:red" tal:content="string: -- (private)" />

</span>

<!-- the status -->

<span class="status-column" tal:condition="python: h.has_permission('task', 'change_status', id=atask.id)" tal:content="structure python: h.select('status', h.options_for_select([(s.name, s.name) for s in c.tasklist.project.statuses], atask.status), method='post', onchange='changeStatus(&quot;%s&quot;,%d)' % (h.url_for(controller='task',action='change_status', id=atask.id), atask.id), id='status_%d' % atask.id) " tal:attributes="id string:status-form_${atask/id};"/>

<span class="status-column" tal:attributes="style python: test(h.has_permission('task', 'change_status', id=atask.id), 'display:none;;', ''); id string:label_${atask/id}; " tal:content="atask/status" />


<span tal:replace="structure python: h.end_form()" />

<!-- end status -->

<!-- deadline -->

<span class="deadline-column" tal:content="atask/deadline" />

<!-- owner -->

<span class="assigned-column" tal:content="python:test(atask.owner, atask.owner, 'unassigned')" />

<!-- subtasks -->

<ul id="xtasks" class="task_list">
<tal:for repeat="atask atask/liveChildren">

<metal:do metal:use-macro="here/task_item/macros/view_task" />

</tal:for>
</ul>

</li>
</metal:macro>
