<metal:macro metal:define-macro="show_task">

<li tal:attributes="id string:task_${atask/id}; task_id atask/id; style string:line-height: 2em;;; sort_index atask/sort_index; owner atask/owner; deadline atask/deadline; priority python: h.priority_as_int(atask.priority); status atask/status; class python: 'taskrow %s' % test(h.has_permission('task', 'update', id=atask.id), 'deletable', 'nondeletable');">

<span tal:attributes="depth python: atask.depth() - c.depth" class="taskitem">

  <span tal:condition="not: c/flat">
    <span tal:replace="structure python: h.image_tag(test(atask.liveChildren(), 'plus.png', 'blank.png'), class_='treewidget', id='collapseButton_%d' % atask.id)" />

    <span tal:attributes="id string:draggable_${atask/id};">
        <span tal:replace="structure python: h.image_tag(test(atask.liveChildren(), '/images/folder_open.png', '/images/file.png'), id = 'handle_%s' % atask.id, 
	style = 'padding-left: %dpx;' % ((atask.depth() - c.depth) * 15), 
	onclick = 'toggleCollapse(%s)' % atask.id, class_='handle')" />

    </span>
  </span>

    <!-- title -->
    <a tal:content="atask/title" tal:attributes="href python:h.url_for(controller='task', action='show', id=atask.id); title atask/text; class python: '%s %s' % (test(atask.status=='done', 'completed-task', 'uncompleted-task'), test(atask.parentID == 0, 'root-task', 'sub-task')); id string:title_${atask/id}" />        <span tal:condition="atask/private" tal:attributes="style string: color:red" tal:content="string: -- (private)" />
</span>




<!-- the status -->

<span class="status-column" tal:condition="python: h.has_permission('task', 'change_status', id=atask.id)" 
      tal:content="structure python: h.statusSelect(atask)"
      tal:attributes="id string:status-form_${atask/id}; style string:display:none"/>

<span class="status-column editable"
      tal:attributes="id string:status-label_${atask/id};
      onclick python:test(h.has_permission('task', 'change_status', id=atask.id), 'viewChangeableField(%d, &quot;status&quot;)' % atask.id, '');;"
      tal:content="atask/status" />

<!-- end status -->

<!-- deadline -->

<span class="deadline-column" tal:condition="python: h.has_permission('task', 'update', id=atask.id)"
      tal:content="structure python: h.datebocks_field('atask', 'deadline', attributes={'id':'deadline_%d' % atask.id}, value=atask.deadline)"
      tal:attributes="id string:deadline-form_${atask/id}; style string:display:none" />

<span class="deadline-column editable"
      tal:attributes="id string:deadline-label_${atask/id};
      onclick python:test(h.has_permission('task', 'update', id=atask.id), 'viewChangeableField(%d, &quot;deadline&quot;)' % atask.id, '')"
      tal:content="python: h.readableDate(atask.deadline)" />

<!-- end deadline -->

<!-- priority -->

<span class="priority-column" tal:condition="python: h.has_permission('task', 'change_priority', id=atask.id)" 
      tal:content="structure python:h.prioritySelect(atask)"
      tal:attributes="id string:priority-form_${atask/id}; style string:display:none"/>

<span tal:replace="structure python:h.possiblyEditableSpan(atask, 'priority', 'change_priority', atask.priority)" />

<!-- end priority -->

<!-- owner -->

<span tal:replace="structure python:h.possiblyEditableSpan(atask, 'owner', 'assign', test(atask.owner, atask.owner, 'Unassigned'))" />

<span class="autocomplete owner-column" tal:condition="python: h.has_permission('task', 'assign', id=atask.id)"
      tal:attributes="id string:owner-form_${atask/id}; style string:display:none">

      <input autocomplete="off" name="owner" size="30" type="text"
      	      tal:attributes="id python:'owner_%s' % atask.id; value atask/owner;
       onchange python:'changeField(&quot;%s&quot;,%d, &quot;owner&quot;)' % (h.url_for(controller='task', action='assign', id=atask.id), atask.id)" />

     <span class="auto_complete" tal:attributes="id string:owner_auto_complete_${atask/id}"></span>

     <!-- this javascript is errorful -->
       <script type="text/javascript"
       tal:content="string: new Ajax.Autocompleter('owner_${atask/id}', 'owner_auto_complete_${atask/id}', '../../../task/auto_complete_for_owner/', {});" />
</span>

<!-- end owner --> 

<!-- creator -->
<!-- span class="creator-column" tal:content="atask/creator" / -->

<span metal:define-slot="post_task" />


</li>
</metal:macro>
