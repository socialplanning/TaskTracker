<metal:macro define-macro="form">

<input type="hidden" name="mode" id="mode" tal:attributes="value python:test(c.security_policy_id, 'simple', 'complex')">

<table>
<tr><td><label for="title">Title:</label></td>
<td><span tal:replace="structure python: h.text_field_r('tasklist', 'title')" /> </td>
</tr>

<tr><td><label for="text">Long description of task list:</label></td>
<td><span tal:replace="structure python: h.text_area_r('tasklist', 'text', rows=10, cols=80)" /></td>
</tr>


<tr><td><label for="policy">Security:</label></td>
<td>

<!-- Complex security settings -->
<div id="complex_form" tal:attributes="style python:test(c.security_policy_id, 'display:none;;', '')">
<tal:for repeat="action c/actions">
<span tal:replace="action/question" />

<span tal:replace="structure python: h.select('action_' + action.action, h.options_for_select([(a.description, a.id) for a in action.roles], c.permissions[action.id]))" />
<br/>
</tal:for>
<a href="#" onclick="$('complex_form').hide(); $('mode').setAttribute('value', 'simple'); $('simple_form').show(); return false;">Show simple security options</a>
</div>

<!-- Simple security settings -->
<div id="simple_form" tal:attributes="style python:test(c.security_policy_id, '', 'display:none;;')">
<span tal:replace="structure python: h.select('policy', h.options_for_select([(p.name, p.id) for p in c.policies], c.security_policy_id))" />

<a href="#" onclick="$('simple_form').hide(); $('mode').setAttribute('value', 'complex'); $('complex_form').show(); return false;">Show advanced security options</a>
</div>
</td>
</tr>

<tr><td><label for="admins">List owners:</label></td>
<td>
<input type="hidden" value="" id="items" name="owners">

<span tal:replace="structure python: h.list_with_checkboxes('list_owners', c.owners, c.uneditableOwners)" />

<span class="autocomplete">
  <label for="owner">Add an owner:</label>   <input autocomplete="off" id="owner" name="owner" size="30" type="text" value="" /><input type="submit" name="submit" value="Add an owner" onclick="addItem($('owner').value);$('owner').value=''; return false;"/>


  <div class="auto_complete" id="owner_auto_complete"></div>
  <script type="text/javascript">new Ajax.Autocompleter('owner', 'owner_auto_complete', 
  '../../../task/auto_complete_for_owner/', {})</script>
</span>

</td>
</tr>


</table>

<span tal:replace="structure python: h.submit('Submit')" />

<script language="JavaScript">
   setupEditableList('list_owners');
</script>

</metal:macro>
